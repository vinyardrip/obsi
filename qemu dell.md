# План виртуализации для Dell Inspiron 7720

**Теги:** #virtualization #kvm #dell #legacy_bios #nixos #windows_vm

> [!DANGER] Важный вердикт: Проброс видеокарты (GPU Passthrough)
> На этом ноутбуке проброс дискретной видеокарты NVIDIA **невозможен**.
> **Причины:**
> 1.  **Legacy BIOS:** Современный метод проброса (VFIO) требует UEFI.
> 2.  **Жесткая реализация Optimus:** Дискретная карта физически не может работать независимо от встроенной. MUX Switch отсутствует.
> 3.  **Ограничения BIOS:** Отсутствуют необходимые настройки для IOMMU (VT-d).
>
> Попытки проброса приведут только к пустой трате времени. План должен быть сосредоточен на стандартной виртуализации.

---

## Рекомендуемый план действий

Цель — использовать KVM/QEMU для создания двух виртуальных машин без графического ускорения, что идеально подходит для ваших задач.

### Сценарий 1: Установка NixOS для изучения

*   **Цель:** Освоить декларативную конфигурацию NixOS.
*   **Метод:** Стандартная ВМ в KVM/QEMU. Графическая среда может быть медленной, но для изучения конфигурационных файлов и работы в терминале это не имеет значения.

### Сценарий 2: Установка Windows для электронной подписи

*   **Цель:** Использовать несколько программ и USB-токен для подписи.
*   **Метод:** Стандартная ВМ в KVM/QEMU. Графическая производительность не важна. Ключевая функция — **проброс USB-устройства**, который KVM/QEMU отлично поддерживает.

---

### Пошаговая инструкция по настройке

1.  **Установка KVM/QEMU и утилит в Arch Linux:**
    ```bash
    sudo pacman -S qemu-full virt-manager virt-viewer dnsmasq vde2 bridge-utils openbsd-netcat ebtables iptables
    ```

2.  **Запуск службы `libvirtd`:**
    ```bash
    sudo systemctl enable --now libvirtd.service
    ```

3.  **Добавление пользователя в группу `libvirt`:**
    ```bash
    sudo usermod -aG libvirt $(whoami)
    ```
    > [!NOTE] После этого необходимо **выйти из системы и снова войти**.

4.  **Создание ВМ для NixOS:**
    *   Запустите `virt-manager`.
    *   Создайте новую ВМ, указав ISO-образ NixOS.
    *   Выделите 2+ ядра ЦП и 4+ ГБ ОЗУ.
    *   Следуйте инструкциям на экране. Не нужно делать никаких специальных настроек PCI.

5.  **Создание ВМ для Windows:**
    *   Скачайте ISO-образ Windows и [ISO-образ с драйверами VirtIO](https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso).
    *   Создайте новую ВМ в `virt-manager`.
    *   На шаге настройки диска, выберите драйвер `viostor` с подключенного ISO VirtIO, чтобы Windows увидела диск.
    *   После установки Windows, установите остальные драйверы с ISO-образа VirtIO для лучшей производительности сети и диска.

6.  **Проброс USB-токена в Windows ВМ:**
    *   Запустите ВМ Windows.
    *   Вставьте ваш USB-токен в ноутбук.
    *   В окне Virt-Manager выберите в меню "Виртуальная машина" -> "Перенаправить USB-устройство" и поставьте галочку напротив вашего токена.
    *   Он появится внутри Windows.