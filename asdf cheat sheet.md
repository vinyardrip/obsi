
# Шпаргалка по ASDF-VM

asdf — это универсальный менеджер версий с поддержкой плагинов. Он позволяет управлять версиями Node.js, Python, Ruby, pnpm и многих других инструментов через один интерфейс и один файл конфигурации (.tool-versions).

## ## > [!IMPORTANT]

> **Золотое правило ASDF:**
> 
> 1. **Добавь плагин** для нужного инструмента.
>     
> 2. **Установи** нужную версию через плагин.
>     
> 3. **Укажи** локальную версию для своего проекта.
>     

---

## 1. Установка и Настройка

### Установка ASDF

codeBash

```
# Клонируем репозиторий
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.14.0
```

### Настройка Оболочки (Shell)

Добавьте эти строки в **конец** вашего конфигурационного файла (~/.zshrc, ~/.bashrc и т.д.).

codeBash

```
# Для ZSH
echo -e "\n. $HOME/.asdf/asdf.sh" >> ~/.zshrc

# Для Bash
echo -e "\n. $HOME/.asdf/asdf.sh" >> ~/.bash_profile
```

> [!WARNING] Обязательно перезапустите терминал!  
> После изменения конфигурационного файла нужно полностью закрыть и снова открыть терминал, чтобы изменения применились.

---

## 2. Управление Плагинами

Плагины — это то, что "учит" asdf работать с разными языками и инструментами.

- **Добавить плагин:**
    
    codeBash
    
    ```
    # Пример для nodejs и pnpm
    asdf plugin-add nodejs
    asdf plugin-add pnpm
    ```
    
- **Посмотреть список установленных плагинов:**
    
    codeBash
    
    ```
    asdf plugin list
    ```
    
- **Посмотреть все доступные плагины:**
    
    codeBash
    
    ```
    asdf plugin list all
    ```
    

---

## 3. Управление Версиями

### Просмотр и Установка

- **Посмотреть все доступные версии инструмента для установки:**
    
    codeBash
    
    ```
    asdf list all nodejs
    ```
    
- **Установить конкретную версию:**
    
    codeBash
    
    ```
    asdf install nodejs 18.17.1
    asdf install pnpm 8.7.0
    ```
    
- **Посмотреть уже установленные версии:**
    
    codeBash
    
    ```
    asdf list nodejs
    asdf list pnpm
    ```
    

### Активация Версий

- **Установить глобальную версию (по умолчанию для всей системы):**  
    Используется, если в проекте нет файла .tool-versions.
    
    codeBash
    
    ```
    asdf global nodejs 18.17.1
    ```
    
- **Установить локальную версию (для конкретного проекта):**  
    **Это самый частый и рекомендуемый способ.** Команда создает или обновляет файл .tool-versions в текущей директории.
    
    codeBash
    
    ```
    # Находясь в папке проекта
    asdf local nodejs 14.20.1
    asdf local pnpm 6.35.1
    ```
    

**Содержимое файла .tool-versions:**

codeCode

```
nodejs 14.20.1
pnpm 6.35.1
```

---

## 4. Диагностика и Решение Проблем

> [!TIP] Эти команды — ваши лучшие друзья при поиске проблем.

- **Посмотреть, какие версии asdf считает активными сейчас:**
    
    codeBash
    
    ```
    asdf current
    ```
    
    Если видите "Not installed", значит версия из .tool-versions не установлена.
    
- **Проверить, что asdf управляет командой:**
    
    codeBash
    
    ```
    which pnpm
    # Правильный ответ: /home/user/.asdf/shims/pnpm
    # Неправильный ответ: /usr/local/bin/pnpm или другой путь
    ```
    
- **Спросить у asdf, какой именно исполняемый файл он будет использовать:**  
    Это ключевая команда для диагностики конфликтов!
    
    codeBash
    
    ```
    asdf which pnpm
    # Правильный ответ: /home/user/.asdf/installs/pnpm/6.35.1/bin/pnpm
    ```
    

### > [!WARNING] Частая проблема: Глобальные пакеты NPM

Если asdf which <package> показывает путь **внутри папки nodejs**, это значит, что у вас конфликт.

- **Проблема:** Вы установили пакет через npm install -g <package>. Этот пакет "привязался" к текущей версии Node.js и перехватил управление у плагина asdf.
    
    codeBash
    
    ```
    # Пример неправильного пути, указывающего на конфликт
    $ asdf which pnpm
    /home/erip/.asdf/installs/nodejs/14.20.1/bin/pnpm
    ```
    
- **Решение:**
    
    1. Удалите "глобальный" пакет с помощью npm:
        
        codeBash
        
        ```
        # Убедитесь, что активна нужная версия Node.js
        npm uninstall -g pnpm
        ```
        
    2. Пересоздайте "прокладки" (shims) для nodejs:
        
        codeBash
        
        ```
        asdf reshim nodejs
        ```
        

### Обновление "прокладок" (shims)

Если вы установили новый инструмент, но команда не находится, или запускается не та версия.

- **Обновить все shims:**
    
    codeBash
    
    ```
    asdf reshim
    ```
    
- **Обновить shims для конкретного плагина:**
    
    codeBash
    
    ```
    asdf reshim nodejs
    ```
    
- **Для ZSH:** Иногда нужно сбросить кэш команд оболочки:
    
    codeBash
    
    ```
    rehash
    ```