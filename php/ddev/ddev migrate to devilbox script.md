```

#!/bin/bash
# ^-- –≠—Ç–æ "shebang". –û–Ω –≥–æ–≤–æ—Ä–∏—Ç —Å–∏—Å—Ç–µ–º–µ, —á—Ç–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω—É–∂–Ω–æ
# –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä Bash. –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞ ---
# –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –µ—Å–ª–∏ –ª—é–±–∞—è –∏–∑ –∫–æ–º–∞–Ω–¥
# –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏
# —á–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
set -e

# --- ‚öôÔ∏è –ë–ê–ó–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
# –ó–¥–µ—Å—å –º—ã –∑–∞–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É—Ç–∏. –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –∫–æ—Ç–æ—Ä–æ–µ, –≤–æ–∑–º–æ–∂–Ω–æ,
# –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–≤–æ–∏—Ö –ø–∞–ø–æ–∫.

# –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Devilbox
DEVILBOX_PATH_ROOT="$HOME/projects/work/devilbox"
# –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≥–¥–µ –ª–µ–∂–∞—Ç –ø–∞–ø–∫–∏ —Å —Å–∞–π—Ç–∞–º–∏ –≤ Devilbox
DEVILBOX_DATA_BASE_PATH="${DEVILBOX_PATH_ROOT}/data"
# –ü—É—Ç—å, –∫—É–¥–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã DDEV
DDEV_PROJECTS_BASE_PATH="$HOME/projects/work/php"
# –ü—É—Ç—å –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ –ë–î
DB_BACKUP_PATH="$HOME/projects/work/db_local"


# --- –£—Ç–∏–ª–∏—Ç—ã –∏ —Ü–≤–µ—Ç–∞ ---
# –ó–¥–µ—Å—å –º—ã –æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.
# –≠—Ç–æ ANSI escape-–∫–æ–¥—ã. –û–Ω–∏ –¥–µ–ª–∞—é—Ç –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ –±–æ–ª–µ–µ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º.
GREEN='\033[0;32m'; YELLOW='\033[1;33m'; BLUE='\033[0;34m'; RED='\033[0;31m';
NC='\033[0m' # No Color (—Å–±—Ä–æ—Å —Ü–≤–µ—Ç–∞)


# --- üìù –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê ---
# –≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
echo -e "${BLUE}--- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ ---${NC}"

# –ö–æ–º–∞–Ω–¥–∞ 'read' —Å –∫–ª—é—á–æ–º '-p' –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ (prompt).
read -p "1. –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è DDEV (–Ω–∞–ø—Ä–∏–º–µ—Ä, grandmebel): " PROJECT_NAME

# –ó–¥–µ—Å—å –º—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–º—è –ø–∞–ø–∫–∏, –∞ –Ω–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å, –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.
read -p "2. –ò–º—è –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Devilbox/data [${PROJECT_NAME:-grandmebel}]: " DEVILBOX_PROJECT_FOLDER
# >> –í–∞–∂–Ω—ã–π –Ω—é–∞–Ω—Å Bash: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `${VAR:-default}` –æ–∑–Ω–∞—á–∞–µ—Ç:
# "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π VAR, –Ω–æ –µ—Å–ª–∏ –æ–Ω–∞ –ø—É—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'default'".
# –ó–¥–µ—Å—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–µ—Ç Enter, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ PROJECT_NAME.
DEVILBOX_PROJECT_FOLDER=${DEVILBOX_PROJECT_FOLDER:-${PROJECT_NAME:-grandmebel}}

# "–°–∫–ª–µ–∏–≤–∞–µ–º" –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –∏ –∏–º—è –ø–∞–ø–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É.
DEVILBOX_PATH_PROJECT="${DEVILBOX_DATA_BASE_PATH}/${DEVILBOX_PROJECT_FOLDER}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∫–∞–∑–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è.
# `if [ ! -d "..." ]` –æ–∑–Ω–∞—á–∞–µ—Ç "–µ—Å–ª–∏ –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è...".
# –≠—Ç–æ –≤–∞–∂–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
if [ ! -d "$DEVILBOX_PATH_PROJECT" ]; then
    echo -e "\n${RED}–û–®–ò–ë–ö–ê: –ò—Å—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:${NC} $DEVILBOX_PATH_PROJECT"; exit 1;
fi

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é PHP –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Devilbox.
read -p "3. –ö–∞–∫—É—é –≤–µ—Ä—Å–∏—é PHP Devilbox –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞? (6/7/8): " DEVILBOX_PHP_VERSION
# `if ! [[ "$VAR" =~ ^[6-8]$ ]]` ‚Äî —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.
# `=~` ‚Äî –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å "—Ä–µ–≥—É–ª—è—Ä–∫–æ–π".
# `^[6-8]$` ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω, –æ–∑–Ω–∞—á–∞—é—â–∏–π: "—Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è (^), —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–¥–Ω—É
# —Ü–∏—Ñ—Ä—É –æ—Ç 6 –¥–æ 8, –∏ –Ω–∞ —ç—Ç–æ–º –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è ($)".
if ! [[ "$DEVILBOX_PHP_VERSION" =~ ^[6-8]$ ]]; then
    echo -e "${RED}–û–®–ò–ë–ö–ê: –ù–µ–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è PHP. –î–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ 6, 7 –∏–ª–∏ 8.${NC}"; exit 1;
fi

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è DDEV.
read -p "4. –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞ DDEV (wordpress, laravel, php) [wordpress]: " PROJECT_TYPE
PROJECT_TYPE=${PROJECT_TYPE:-wordpress}
read -p "5. –í–µ—Ä—Å–∏—è PHP –¥–ª—è DDEV [7.4]: " DDEV_PHP_VERSION
DDEV_PHP_VERSION=${DDEV_PHP_VERSION:-7.4}

echo -e "${BLUE}--- –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ë–î –≤ Devilbox ---${NC}"
read -p "–ò–º—è –ë–î [${PROJECT_NAME:-grandmebel}]: " DB_NAME
DB_NAME=${DB_NAME:-${PROJECT_NAME:-grandmebel}}
read -p "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î [root]: " DB_USER
DB_USER=${DB_USER:-root}
# –ö–ª—é—á '-s' (silent) —É –∫–æ–º–∞–Ω–¥—ã 'read' —Å–∫—Ä—ã–≤–∞–µ—Ç –≤–≤–æ–¥. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.
read -s -p "–ü–∞—Ä–æ–ª—å –ë–î (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç): " DB_PASS
echo "" # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏, —Ç–∞–∫ –∫–∞–∫ '-s' –µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç.


# --- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ---
# –ù–∞ –æ—Å–Ω–æ–≤–µ –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º—ã –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
DDEV_PATH="${DDEV_PROJECTS_BASE_PATH}/${PROJECT_NAME}"
OLD_URL="httpshttps://${DEVILBOX_PROJECT_FOLDER}.loc"
NEW_URL="https://${PROJECT_NAME}.lo" # –°—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ–º https, —Ç–∞–∫ –∫–∞–∫ DDEV –Ω–∞—Å—Ç—Ä–æ–∏—Ç –µ–≥–æ –¥–ª—è .lo
# >> –í–∞–∂–Ω—ã–π –Ω—é–∞–Ω—Å Bash: `$(–∫–æ–º–∞–Ω–¥–∞)` ‚Äî —ç—Ç–æ "command substitution".
# Bash —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É `date +%Y-%m-%d`, –∞ –∑–∞—Ç–µ–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç
# –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "2025-08-13") –≤ —Å—Ç—Ä–æ–∫—É.
BACKUP_FILE_PATH="${DB_BACKUP_PATH}/${PROJECT_NAME}-$(date +%Y-%m-%d).sql"


# --- –§–ò–ù–ê–õ–¨–ù–û–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï ---
# "–¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞". –î–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —à–∞–Ω—Å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
# –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥. –•–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –ª—é–±—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.
echo -e "\n${YELLOW}--- –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ ---${NC}"
echo "–ò—Å—Ç–æ—á–Ω–∏–∫ (Devilbox):        ${GREEN}${DEVILBOX_PATH_PROJECT}${NC}"
echo "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ (DDEV):          ${GREEN}${DDEV_PATH}${NC}"
echo "–ù–æ–≤—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π URL:          ${GREEN}${NEW_URL}${NC}"
echo "-------------------------------------"
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é? (y/n): " CONFIRM
if [ "$CONFIRM" != "y" ]; then echo "–ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."; exit 1; fi


# --- –°–ö–†–ò–ü–¢ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–ò ---

# --- –®–∞–≥ 1: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Devilbox –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ ---
echo -e "\n${BLUE}–®–∞–≥ 1.1: –ó–∞–ø—É—Å–∫ Devilbox (PHP ${DEVILBOX_PHP_VERSION}) –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞...${NC}"
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É Devilbox, —Ç–∞–∫ –∫–∞–∫ `docker-compose` –∏—â–µ—Ç .yml —Ñ–∞–π–ª –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
cd "$DEVILBOX_PATH_ROOT"
# –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –≤–∞—à—É –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è .env —Ñ–∞–π–ª–æ–≤.
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä—è—á–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π .env, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–µ—Ä–µ—Ç—å –µ–≥–æ.
if [ -f ".env" ]; then mv .env env; fi
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π .env-X –≤ .env, –∞–∫—Ç–∏–≤–∏—Ä—É—è –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é PHP.
mv ".env-${DEVILBOX_PHP_VERSION}" .env
# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –ö–ª—é—á '-d' (detached) –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏—Ö –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.
docker-compose up -d httpd php mysql mailhog
echo -e "${YELLOW}–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ë–î (10 —Å–µ–∫—É–Ω–¥)...${NC}"
# `sleep 10` ‚Äî –ø—Ä–æ—Å—Ç–∞—è –ø–∞—É–∑–∞. –ù—É–∂–Ω–∞, —á—Ç–æ–±—ã MySQL —É—Å–ø–µ–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
# –∏ –±—ã–ª –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ë–µ–∑ –Ω–µ–µ `mysqldump` –º–æ–∂–µ—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è.
sleep 10

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä–æ–ª—è.
# –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø—É—Å—Ç—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏.
PASSWORD_ARG=""
# `if [ -n "$VAR" ]` –æ–∑–Ω–∞—á–∞–µ—Ç "–µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è VAR –ù–ï –ø—É—Å—Ç–∞—è...".
if [ -n "$DB_PASS" ]; then PASSWORD_ARG="-p${DB_PASS}"; fi

echo -e "${BLUE}–®–∞–≥ 1.2: –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...${NC}"
# `mkdir -p` —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ö–ª—é—á '-p'
# —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
mkdir -p "$DB_BACKUP_PATH"
# `docker-compose exec -T` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
# `-T` –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Å–µ–≤–¥–æ-—Ç–µ—Ä–º–∏–Ω–∞–ª, —á—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤.
# `$PASSWORD_ARG` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑ –∫–∞–≤—ã—á–µ–∫, —á—Ç–æ–±—ã –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—É—Å—Ç–∞,
# bash –ø—Ä–æ—Å—Ç–æ —É–±—Ä–∞–ª –µ–µ, –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–≤ –ø—É—Å—Ç—ã–µ –∫–∞–≤—ã—á–∫–∏.
docker-compose exec -T mysql mysqldump -u "$DB_USER" $PASSWORD_ARG "$DB_NAME" > "$BACKUP_FILE_PATH"
echo "‚úî –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ $BACKUP_FILE_PATH"

echo -e "${BLUE}–®–∞–≥ 1.3: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Devilbox –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤...${NC}"
# `docker-compose down` ‚Äî –±–æ–ª–µ–µ –º–æ—â–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞, —á–µ–º 'stop'. –û–Ω–∞ –Ω–µ —Ç–æ–ª—å–∫–æ
# –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç, –Ω–æ –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Å–µ—Ç–∏, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞—è —Ä–µ—Å—É—Ä—Å—ã.
docker-compose down
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º .env —Ñ–∞–π–ª—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
mv .env ".env-${DEVILBOX_PHP_VERSION}"
if [ -f "env" ]; then mv env .env; fi
echo "‚úî Devilbox –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã."


# --- –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DDEV ---
echo -e "${BLUE}–®–∞–≥ 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞...${NC}"
mkdir -p "$DDEV_PROJECTS_BASE_PATH"
# `cp -R` –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.
cp -R "$DEVILBOX_PATH_PROJECT" "$DDEV_PATH"
echo "‚úî –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ $DDEV_PATH"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–æ–≤—É—é –ø–∞–ø–∫—É, —á—Ç–æ–±—ã –≤—Å–µ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∫–æ–º–∞–Ω–¥—ã (ddev, git)
# –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
cd "$DDEV_PATH"

echo -e "${BLUE}–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DDEV –∏ Git...${NC}"
mkdir -p .ddev
# >> –í–∞–∂–Ω—ã–π –Ω—é–∞–Ω—Å Bash: `cat << EOF > file.txt` ‚Äî —ç—Ç–æ "Here Document".
# –í—Å–µ, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–µ–∂–¥—É `EOF` –∏ `EOF`, –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ –≤ `file.txt`.
# –≠—Ç–æ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä—è–º–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ.
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ ($PROJECT_NAME –∏ –¥—Ä.) –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è.
cat << EOF > .ddev/config.yaml
name: $PROJECT_NAME
type: $PROJECT_TYPE
docroot: ""
php_version: "$DDEV_PHP_VERSION"
webserver_type: apache-fpm
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º .lo –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
project_tld: lo

# –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö 
database: 
	type: mariadb # –∏–ª–∏ mysql 
	version: "10.11" # —É–∫–∞–∂–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é 
	name: $PROJECT_NAME
EOF
# `> /dev/null 2>&1` ‚Äî –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã.
# `> /dev/null` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (stdout) –≤ "—á–µ—Ä–Ω—É—é –¥—ã—Ä—É".
# `2>&1` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ (stderr) —Ç—É–¥–∞ –∂–µ, –∫—É–¥–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π.
ddev get ddev/ddev-phpmyadmin > /dev/null 2>&1

# "–£–º–Ω–∞—è" –æ–±—Ä–∞–±–æ—Ç–∫–∞ Git.
if [ -d ".git" ]; then
    # –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã DDEV.
    git add .ddev/config.yaml .ddev/phpmyadmin.yaml
    # –î–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å —á—Ç–æ –∫–æ–º–º–∏—Ç–∏—Ç—å.
    if [[ -n $(git status --porcelain) ]]; then git commit -m "chore: Configure DDEV for local development"; fi
    echo "‚úî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DDEV –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π."
else
    # –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–µ—Ç, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—ã–π.
    curl -s -o .gitignore https://raw.githubusercontent.com/github/gitignore/main/WordPress.gitignore
    git init -b main > /dev/null 2>&1; git add . > /dev/null 2>&1; git commit -m "Initial commit: Project setup with DDEV" > /dev/null 2>&1
    echo "‚úî –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π."
fi

echo -e "${BLUE}–®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ DDEV...${NC}"
echo -e "${YELLOW}–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ PHP.${NC}"
# `-y` (yes) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç "–¥–∞" –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç DDEV.
ddev start -y

echo -e "${BLUE}–®–∞–≥ 5: –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...${NC}"
ddev import-db --file="$BACKUP_FILE_PATH"

echo -e "${BLUE}–®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL...${NC}"
# –¢–µ–ø–µ—Ä—å –º—ã —Å—Ä–∞–∑—É –º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π URL –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL —Å https.
ddev exec wp search-replace "$OLD_URL" "$NEW_URL" --all-tables > /dev/null 2>&1
echo "‚úî URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω—ã."

echo -e "${BLUE}–®–∞–≥ 7: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...${NC}"
read -p "–•–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ (${BACKUP_FILE_PATH})? (y/n) [n]: " DELETE_BACKUP
# `${VAR:-n}` ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º–µ—Ç Enter, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ 'n'.
if [[ "${DELETE_BACKUP:-n}" == "y" ]]; then
    rm "$BACKUP_FILE_PATH"
    echo "‚úî –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ —É–¥–∞–ª–µ–Ω."
else
    echo "‚úî –§–∞–π–ª –±—ç–∫–∞–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω."
fi

echo -e "\n${GREEN}üéâ –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ${NC}"
echo -e "–°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: ${YELLOW}${NEW_URL}${NC}"