
```bash
#!/usr/bin/env bash
# =================================================================
# –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô —Å–∫—Ä–∏–ø—Ç –¥–ª—è "–æ—Å–≤–µ–∂–µ–Ω–∏—è" –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
# –í–ï–†–°–ò–Ø 3.1: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Devilbox –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
#
# –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
# 1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Devilbox.
# 2. –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î.
# 3. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ CMS, –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–º–µ–Ω—ã URL.
# 4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–º–ø —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, –∑–∞—Ç–∏—Ä–∞—è —Å—Ç–∞—Ä—É—é –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î.
# =================================================================

set -e

# --- ‚öôÔ∏è –ë–ê–ó–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
DB_PROD_PATH="$HOME/projects/work/db_prod"
DB_LOCAL_PATH="$HOME/projects/work/db_local"
DDEV_PROJECTS_BASE_PATH="$HOME/projects/work/php"
# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ Devilbox –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
DEVILBOX_PATH_ROOT="$HOME/projects/work/devilbox"

# --- –£—Ç–∏–ª–∏—Ç—ã –∏ —Ü–≤–µ—Ç–∞ ---
if command -v tput >/dev/null 2>&1; then
    GREEN=$(tput setaf 2); YELLOW=$(tput setaf 3); BLUE=$(tput setaf 4); RED=$(tput setaf 1); NC=$(tput sgr0)
else
    GREEN='\033[0;32m'; YELLOW='\033[1;33m'; BLUE='\033[0;34m'; RED='\033[0;31m'; NC='\033[0m'
fi

# --- üöÄ –ù–ê–ß–ê–õ–û –†–ê–ë–û–¢–´ ---
printf "%s--- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ---%s\n" "${BLUE}" "${NC}"

# === –ù–û–í–´–ô –ë–õ–û–ö: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø–æ—Ä—Ç–æ–≤ ===
if [ -d "$DEVILBOX_PATH_ROOT" ]; then
    printf "\n%s--- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Devilbox ---%s\n" "${BLUE}" "${NC}"
    printf "–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø–æ—Ä—Ç–æ–≤, Devilbox –±—É–¥–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω...\n"
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ –ø–æ–¥-–æ–±–æ–ª–æ—á–∫–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
    (cd "$DEVILBOX_PATH_ROOT" && docker-compose down >/dev/null 2>&1)
    printf "‚úî Devilbox —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.\n"
fi
# === –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê ===

# === –®–ê–ì 1: –í–´–ë–û–† –¢–ò–ü–ê –ü–†–û–ï–ö–¢–ê ===
printf "\n%s--- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø—Ä–æ–µ–∫—Ç–∞ ---%s\n" "${BLUE}" "${NC}"
echo "1. WordPress (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞ URL —á–µ—Ä–µ–∑ WP-CLI)"
echo "2. Joomla (–∑–∞–º–µ–Ω–∞ URL –≤ SQL-—Ñ–∞–π–ª–µ)"
echo "3. OpenCart (–∑–∞–º–µ–Ω–∞ URL –≤ SQL-—Ñ–∞–π–ª–µ)"
echo "4. –î—Ä—É–≥–æ–π PHP –ø—Ä–æ–µ–∫—Ç —Å –ë–î (–∑–∞–º–µ–Ω–∞ URL –≤ SQL-—Ñ–∞–π–ª–µ)"
read -p "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞ [1]: " PROJECT_CHOICE
PROJECT_CHOICE=${PROJECT_CHOICE:-1}

case "$PROJECT_CHOICE" in
    1) CMS_TYPE="wordpress";;
    2) CMS_TYPE="joomla";;
    3) CMS_TYPE="opencart";;
    4) CMS_TYPE="php";;
    *) printf "%s–û–®–ò–ë–ö–ê: –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.%s\n" "${RED}" "${NC}"; exit 1 ;;
esac
printf "‚úî –í—ã–±—Ä–∞–Ω —Ç–∏–ø: %s\n" "$CMS_TYPE"

# --- –û–ë–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–ï–ö–¢–ê ---
read -p "1. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ DDEV (–Ω–∞–ø—Ä–∏–º–µ—Ä, grandmebel): " PROJECT_NAME
if [ -z "$PROJECT_NAME" ]; then printf "%s–û–®–ò–ë–ö–ê: –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.%s\n" "${RED}" "${NC}"; exit 1; fi

DDEV_PROJECT_PATH="${DDEV_PROJECTS_BASE_PATH}/${PROJECT_NAME}"
if [ ! -d "$DDEV_PROJECT_PATH" ]; then
  printf "\n%s–û–®–ò–ë–ö–ê: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ –ø—É—Ç–∏:%s\n  %s\n" "${RED}" "${NC}" "${DDEV_PROJECT_PATH}"; exit 1
fi

read -p "   –î–æ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (.by, .com, etc) [.by]: " PROD_TLD
PROD_TLD=${PROD_TLD:-"by"}; RAW_DOMAIN="${PROJECT_NAME}.${PROD_TLD//./}"

printf "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ '%s'...\n" "$PROJECT_NAME"
if ! ddev describe "$PROJECT_NAME" | grep -q "OK"; then
    printf "\n%s–í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ–µ–∫—Ç '%s' –Ω–µ –∑–∞–ø—É—â–µ–Ω.%s\n" "${YELLOW}" "$PROJECT_NAME" "${NC}"
    read -p "–ó–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —Å–µ–π—á–∞—Å? (y/n): " CONFIRM_START
    if [ "$CONFIRM_START" = "y" ]; then ddev start -p "$PROJECT_NAME"; else printf "%s–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.%s\n" "${RED}" "${NC}"; exit 1; fi
fi
printf "‚úî –ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.\n"

read -p "2. –ò–º—è —Ñ–∞–π–ª–∞ –ë–î –∏–∑ '${DB_PROD_PATH}' (–±–µ–∑ .sql) [${PROJECT_NAME}]: " DB_FILENAME_BASE
DB_FILENAME_BASE=${DB_FILENAME_BASE:-${PROJECT_NAME}}
INPUT_FILE_PATH="${DB_PROD_PATH}/${DB_FILENAME_BASE}.sql"
if [ ! -f "$INPUT_FILE_PATH" ]; then
  printf "\n%s–û–®–ò–ë–ö–ê: –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω:%s %s\n" "${RED}" "${NC}" "$INPUT_FILE_PATH"; exit 1;
fi

read -p "3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (1=https, 2=http) [1]: " PROTOCOL_CHOICE
PROTOCOL_CHOICE=${PROTOCOL_CHOICE:-1}
case "$PROTOCOL_CHOICE" in
    1) PROD_URL="https://${RAW_DOMAIN}" ;;
    2) PROD_URL="http://${RAW_DOMAIN}" ;;
    *) printf "%s–û–®–ò–ë–ö–ê: –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.%s\n" "${RED}" "${NC}"; exit 1 ;;
esac

LOCAL_URL="https://${PROJECT_NAME}.lo"

# =================================================================
#  üöÄ –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
# =================================================================

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã ddev
cd "$DDEV_PROJECT_PATH"

# ---- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –†–ï–ó–ï–†–í–ù–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï ----
printf "\n%s–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...%s\n" "${BLUE}" "${NC}"
mkdir -p "$DB_LOCAL_PATH"
CURRENT_DATE=$(date +%Y-%m-%d)
BACKUP_FILENAME="${PROJECT_NAME}_${CURRENT_DATE}_local_backup.sql"
BACKUP_FILE_PATH="${DB_LOCAL_PATH}/${BACKUP_FILENAME}"
ddev export-db --gzip=false > "$BACKUP_FILE_PATH"
printf "‚úî –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤:\n%s%s%s\n" "${YELLOW}" "${BACKUP_FILE_PATH}" "${NC}"

# --- –°–≤–æ–¥–∫–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ---
printf "\n%s--- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ---%s\n" "${BLUE}" "${NC}"
echo "–ü—Ä–æ–µ–∫—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:      ${GREEN}${PROJECT_NAME} (${CMS_TYPE})${NC}"
echo "–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–¥):       ${GREEN}${INPUT_FILE_PATH}${NC}"
printf "\n%s–í–ù–ò–ú–ê–ù–ò–ï: –¢–µ–∫—É—â–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ '%s' –±—É–¥–µ—Ç –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ó–ê–ü–ò–°–ê–ù–ê!%s\n" "${RED}" "$PROJECT_NAME" "${NC}"
echo "–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–∞—à–µ–π —Å—Ç–∞—Ä–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞."
echo "---------------------------"
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ? (y/n): " CONFIRM
if [ "$CONFIRM" != "y" ]; then printf "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.\n"; exit 1; fi

# === –£–°–õ–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø ===
if [ "$CMS_TYPE" = "wordpress" ]; then
    # --- –ü—É—Ç—å –¥–ª—è WordPress ---
    printf "\n%s–®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–¥–∞–º–ø–∞ –≤ DDEV...%s\n" "${BLUE}" "${NC}"
    ddev import-db --file="$INPUT_FILE_PATH"
    printf "‚úî –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞.\n"

    printf "\n%s–®–∞–≥ 3: –ó–∞–º–µ–Ω–∞ URL –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (WP-CLI)...%s\n" "${BLUE}" "${NC}"
    ddev exec "wp search-replace '$PROD_URL' '$LOCAL_URL' --all-tables --allow-root"
    printf "‚úî URL —É—Å–ø–µ—à–Ω–æ –∑–∞–º–µ–Ω–µ–Ω—ã. –í–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –æ–±–Ω–æ–≤–ª–µ–Ω.\n"
else
    # --- –ü—É—Ç—å –¥–ª—è Joomla, OpenCart –∏ –¥—Ä—É–≥–∏—Ö PHP –ø—Ä–æ–µ–∫—Ç–æ–≤ ---
    printf "\n%s–®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∑–∞–º–µ–Ω–∞ URL –≤ SQL-—Ñ–∞–π–ª–µ...%s\n" "${BLUE}" "${NC}"
    TEMP_SQL_FILE="/tmp/${PROJECT_NAME}_refresh_$(date +%s).sql"
    cp "$INPUT_FILE_PATH" "$TEMP_SQL_FILE"
    sed -i "s|${PROD_URL}|${LOCAL_URL}|g" "$TEMP_SQL_FILE"
    printf "‚úî –í—Ä–µ–º–µ–Ω–Ω—ã–π SQL-—Ñ–∞–π–ª —Å –∑–∞–º–µ–Ω–µ–Ω–Ω—ã–º–∏ URL –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω.\n"

    printf "\n%s–®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–∞–º–ø–∞ –≤ DDEV...%s\n" "${BLUE}" "${NC}"
    ddev import-db --file="$TEMP_SQL_FILE"
    rm "$TEMP_SQL_FILE" # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    printf "‚úî –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.\n"
fi

printf "\n%süéâ –ì–æ—Ç–æ–≤–æ! üéâ%s\n" "${GREEN}" "${NC}"
printf "–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–∞–π—Ç '%s' —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.\n" "$PROJECT_NAME"
printf "–û–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: %s%s%s\n" "${YELLOW}" "${LOCAL_URL}" "${NC}"
ddev launch

# –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∏—Å—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd - > /dev/null

exit 0
```

## üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∫–∏ –∏–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
–ö–æ–º–∞–Ω–¥–∞: `./refresh-local.sh` (–∑–∞–ø—É—Å–∫–∞—Ç—å –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞)

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º:
- `chmod +x refresh-local.sh`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç–∏ –≤ —à–∞–ø–∫–µ —Å–∫—Ä–∏–ø—Ç–∞ (DB_PROD_PATH, DB_LOCAL_PATH, DDEV_PROJECTS_BASE_PATH)
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–º–ø `–∏–º—è_–ø—Ä–æ–µ–∫—Ç–∞.sql` –ª–µ–∂–∏—Ç –≤ `db_prod`

```
ddev-refresh
```

–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π —Å–∫—Ä–∏–ø—Ç–∞:
1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Devilbox (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)
2. –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–∏–ø CMS –∏ –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞
3. –î–µ–ª–∞–µ—Ç –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –≤ `db_local`
4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–¥-–¥–∞–º–ø
5. –ó–∞–º–µ–Ω—è–µ—Ç –ø—Ä–æ–¥-URL –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π (`*.lo`) –Ω—É–∂–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
6. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ì–æ—Ç–æ–≤–æ! –õ–æ–∫–∞–ª–∫–∞ = –ø—Ä–æ–¥–∞–∫—à–µ–Ω –±–µ–∑ —Ä—É—á–Ω–æ–π –≤–æ–∑–Ω–∏.