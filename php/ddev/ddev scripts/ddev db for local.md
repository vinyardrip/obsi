
```bash
#!/usr/bin/env bash
# =================================================================
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ "Ð¾ÑÐ²ÐµÐ¶ÐµÐ½Ð¸Ñ" Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ°Ð¹Ñ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°.
# Ð’Ð•Ð Ð¡Ð˜Ð¯ 2.0: "Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ" Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼ Ð±ÑÐºÐ°Ð¿Ð¾Ð¼.
#
# Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:
# 1. ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð‘Ð”.
# 2. Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð´Ð°Ð¼Ð¿ Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°, Ð·Ð°Ñ‚Ð¸Ñ€Ð°Ñ ÑÑ‚Ð°Ñ€ÑƒÑŽ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð‘Ð”.
# 3. ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð·Ð°Ð¼ÐµÐ½ÑÐµÑ‚ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-URL Ð½Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ WP-CLI.
# =================================================================

set -e

# --- âš™ï¸ Ð‘ÐÐ—ÐžÐ’ÐÐ¯ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ ---
DB_PROD_PATH="$HOME/projects/work/db_prod"
DB_LOCAL_PATH="$HOME/projects/work/db_local"
DDEV_PROJECTS_BASE_PATH="$HOME/projects/work/php"

# --- Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ Ð¸ Ñ†Ð²ÐµÑ‚Ð° ---
if command -v tput >/dev/null 2>&1; then
    GREEN=$(tput setaf 2); YELLOW=$(tput setaf 3); BLUE=$(tput setaf 4); RED=$(tput setaf 1); NC=$(tput sgr0)
else
    GREEN='\033[0;32m'; YELLOW='\033[1;33m'; BLUE='\033[0;34m'; RED='\033[0;31m'; NC='\033[0m'
fi

# --- ðŸš€ ÐÐÐ§ÐÐ›Ðž Ð ÐÐ‘ÐžÐ¢Ð« ---
printf "%s--- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð‘Ð” Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° ---%s\n" "${BLUE}" "${NC}"

# 1. Ð—Ð°Ð¿Ñ€Ð¾Ñ ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
read -p "1. Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° DDEV (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, grandmebel): " PROJECT_NAME
if [ -z "$PROJECT_NAME" ]; then printf "%sÐžÐ¨Ð˜Ð‘ÐšÐ: Ð˜Ð¼Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼.%s\n" "${RED}" "${NC}"; exit 1; fi

DDEV_PROJECT_PATH="${DDEV_PROJECTS_BASE_PATH}/${PROJECT_NAME}"
if [ ! -d "$DDEV_PROJECT_PATH" ]; then
  printf "\n%sÐžÐ¨Ð˜Ð‘ÐšÐ: Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð¿Ð¾ Ð¿ÑƒÑ‚Ð¸:%s\n  %s\n" "${RED}" "${NC}" "${DDEV_PROJECT_PATH}"; exit 1
fi

read -p "   Ð”Ð¾Ð¼ÐµÐ½Ð½Ð°Ñ Ð·Ð¾Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° (.by, .com, etc) [.by]: " PROD_TLD
PROD_TLD=${PROD_TLD:-"by"}; RAW_DOMAIN="${PROJECT_NAME}.${PROD_TLD//./}"

printf "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° '%s'...\n" "$PROJECT_NAME"
if ! ddev describe "$PROJECT_NAME" | grep -q "OK"; then
    printf "\n%sÐ’ÐÐ˜ÐœÐÐÐ˜Ð•: ÐŸÑ€Ð¾ÐµÐºÑ‚ '%s' Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½.%s\n" "${YELLOW}" "$PROJECT_NAME" "${NC}"
    read -p "Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ? (y/n): " CONFIRM_START
    if [ "$CONFIRM_START" = "y" ]; then ddev start -p "$PROJECT_NAME"; else printf "%sÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°.%s\n" "${RED}" "${NC}"; exit 1; fi
fi
printf "âœ” ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ð³Ð¾Ñ‚Ð¾Ð² Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ.\n"

read -p "2. Ð˜Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð° Ð‘Ð” Ð¸Ð· '${DB_PROD_PATH}' (Ð±ÐµÐ· .sql) [${PROJECT_NAME}]: " DB_FILENAME_BASE
DB_FILENAME_BASE=${DB_FILENAME_BASE:-${PROJECT_NAME}}
INPUT_FILE_PATH="${DB_PROD_PATH}/${DB_FILENAME_BASE}.sql"
if [ ! -f "$INPUT_FILE_PATH" ]; then
  printf "\n%sÐžÐ¨Ð˜Ð‘ÐšÐ: Ð¤Ð°Ð¹Ð» Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½:%s %s\n" "${RED}" "${NC}" "$INPUT_FILE_PATH"; exit 1;
fi

read -p "3. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð» Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° (1=https, 2=http) [1]: " PROTOCOL_CHOICE
PROTOCOL_CHOICE=${PROTOCOL_CHOICE:-1}
case "$PROTOCOL_CHOICE" in
    1) PROD_URL="https://${RAW_DOMAIN}" ;;
    2) PROD_URL="http://${RAW_DOMAIN}" ;;
    *) printf "%sÐžÐ¨Ð˜Ð‘ÐšÐ: ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€.%s\n" "${RED}" "${NC}"; exit 1 ;;
esac

LOCAL_URL="https://${PROJECT_NAME}.lo"

# =================================================================
#  ðŸš€ ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
# =================================================================

# ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ddev
cd "$DDEV_PROJECT_PATH"

# ---- ÐÐžÐ’Ð«Ð™ ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐ«Ð™ Ð¨ÐÐ“: Ð Ð•Ð—Ð•Ð Ð’ÐÐžÐ• ÐšÐžÐŸÐ˜Ð ÐžÐ’ÐÐÐ˜Ð• ----
printf "\n%sÐ¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð¿Ð¸Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…...%s\n" "${BLUE}" "${NC}"
mkdir -p "$DB_LOCAL_PATH"
CURRENT_DATE=$(date +%Y-%m-%d)
BACKUP_FILENAME="${PROJECT_NAME}_${CURRENT_DATE}_local_backup.sql"
BACKUP_FILE_PATH="${DB_LOCAL_PATH}/${BACKUP_FILENAME}"

ddev export-db --gzip=false > "$BACKUP_FILE_PATH"
printf "âœ” Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð° Ð²:\n%s%s%s\n" "${YELLOW}" "${BACKUP_FILE_PATH}" "${NC}"
# ---- ÐšÐžÐÐ•Ð¦ ÐÐžÐ’ÐžÐ“Ðž Ð¨ÐÐ“Ð ----

# --- Ð¡Ð²Ð¾Ð´ÐºÐ° Ð¸ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ ---
printf "\n%s--- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ---%s\n" "${BLUE}" "${NC}"
echo "ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ:      ${GREEN}${PROJECT_NAME}${NC}"
echo "Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð¿Ñ€Ð¾Ð´):       ${GREEN}${INPUT_FILE_PATH}${NC}"
printf "\n%sÐ’ÐÐ˜ÐœÐÐÐ˜Ð•: Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° '%s' Ð±ÑƒÐ´ÐµÑ‚ ÐŸÐžÐ›ÐÐžÐ¡Ð¢Ð¬Ð® ÐŸÐ•Ð Ð•Ð—ÐÐŸÐ˜Ð¡ÐÐÐ!%s\n" "${RED}" "$PROJECT_NAME" "${NC}"
echo "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ Ð²Ð°ÑˆÐµÐ¹ ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð‘Ð” ÑƒÐ¶Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð°."
echo "---------------------------"
read -p "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ? (y/n): " CONFIRM
if [ "$CONFIRM" != "y" ]; then printf "ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°.\n"; exit 1; fi


printf "\n%sÐ¨Ð°Ð³ 2: Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-Ð´Ð°Ð¼Ð¿Ð° Ð² DDEV...%s\n" "${BLUE}" "${NC}"
ddev import-db --file="$INPUT_FILE_PATH"
printf "âœ” Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°.\n"

printf "\n%sÐ¨Ð°Ð³ 3: Ð—Ð°Ð¼ÐµÐ½Ð° URL Ð½Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ...%s\n" "${BLUE}" "${NC}"
ddev exec "wp search-replace '$PROD_URL' '$LOCAL_URL' --all-tables --allow-root"
printf "âœ” URL ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ‹. Ð’Ð°Ñˆ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ°Ð¹Ñ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½.\n"

printf "\n%sðŸŽ‰ Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! ðŸŽ‰%s\n" "${GREEN}" "${NC}"
printf "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ°Ð¹Ñ‚ '%s' ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°.\n" "$PROJECT_NAME"
printf "ÐžÐ½ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ: %s%s%s\n" "${YELLOW}" "${LOCAL_URL}" "${NC}"
ddev launch

# Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ Ð² Ð¸ÑÑ…Ð¾Ð´Ð½ÑƒÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ
cd - > /dev/null

exit 0