
# Настройка почты в DDEV

В DDEV есть два основных способа работы с исходящей электронной почтой с локальных сайтов: перехватчик **Mailpit** (по умолчанию) и отправка реальных писем через **SMTP**.

---

## Вариант 1: Mailpit (Перехватчик писем)

**Идеально для 90% задач разработки:** быстрая проверка факта отправки письма и его внешнего вида без реальной отправки.

### Как использовать

1.  **Настройка CMS:** Убедитесь, что в настройках почты вашего сайта (WordPress, Joomla и т.д.) в качестве способа отправки выбран `PHP Mail()` или `Sendmail`. **Не SMTP**.
2.  **Отправьте тестовое письмо** с сайта (например, через форму обратной связи или регистрацию).
3.  **Откройте интерфейс Mailpit.** Для этого, находясь в папке проекта, выполните команду:
    ```bash
    ddev mailpit
    ```
    Или откройте в браузере URL вида `https://<имя-проекта>.lo:8026`.

В открывшемся веб-интерфейсе вы увидите все "пойманные" письма.

---

## Вариант 2: Реальная отправка через SMTP

**Идеально для тестирования полного цикла доставки:** проверка доставляемости, попадания в спам и отображения в реальных почтовых клиентах (Gmail, Outlook и т.д.).

### Шаг 1: Глобальная настройка SMTP (делается один раз)

Чтобы не настраивать SMTP для каждого проекта, мы создадим единый глобальный конфиг.

1.  Перейдите в глобальную папку DDEV:
    ```bash
    cd ~/.ddev
    ```
2.  Создайте и откройте файл `smtp.yaml`:
    ```bash
    touch smtp.yaml
    micro ~/.ddev/smtp.yaml
    ```
3.  Вставьте в него ваши SMTP-реквизиты.

    **Пример для Gmail:**
    ```yaml
    # Глобальная конфигурация SMTP для DDEV

    hostname: smtp.gmail.com
    port: 587
    username: 
    # ВАЖНО: Для Gmail и многих других сервисов нужен специальный "пароль для приложений"
    password: ""
    security: tls
    ```
4.  Сохраните и закройте файл. Эта настройка выполнена **один раз и навсегда**.

### Шаг 2: Включение SMTP для конкретного проекта

Для любого проекта, который должен отправлять реальную почту, нужно выполнить следующие действия:

1.  Перейдите в папку проекта:
    ```bash
    cd ~/projects/work/php/<имя-проекта>
    ```
2.  Установите официальный аддон `ddev-smtp`:
    ```bash
    ddev get ddev/ddev-smtp
    ```
3.  Перезапустите проект, чтобы активировать аддон:
    ```bash
    ddev restart
    ```

Теперь все письма, отправленные с этого проекта, будут уходить через ваш глобально настроенный SMTP-сервер. Mailpit для этого проекта будет автоматически отключен.

### Как вернуть Mailpit для проекта

Если вы захотите снова использовать перехватчик для этого проекта, просто удалите аддон:

```bash
# Находясь в папке проекта
ddev remove --remove-data ddev/ddev-smtp
ddev restart