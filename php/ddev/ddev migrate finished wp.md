
# Чек-лист: Решение проблем после миграции WordPress в DDEV

Этот документ — пошаговое руководство для решения самых частых проблем (пропали стили, картинки, неверные ссылки) после переноса сайта WordPress.

> [!TIP] Как пользоваться  
> Двигайтесь по шагам сверху вниз. После каждого шага делайте **жесткую перезагрузку** в браузере (Ctrl+Shift+R или Cmd+Shift+R). Если проблема решена, дальше можно не идти.

---

## ✅ Шаг 0: Первоначальная настройка wp-config.php

> Это нужно сделать **один раз** сразу после миграции и запуска ddev start.

1. **Откройте** файл ~/путь/до/проекта/wp-config.php.
    
2. **Закомментируйте** старые настройки базы данных, поставив // в начале строк:
    
    codePHP
    
    ````
    // define( 'DB_NAME', '...' );
    // define( 'DB_USER', '...' );
    // define( 'DB_PASSWORD', '...' );
    // define( 'DB_HOST', '...' );
    ```3.  **Вставьте** код DDEV перед строкой `/* That's all, stop editing! */`:
    ```php
    // Include for ddev-managed settings in wp-config-ddev.php.
    $ddev_settings = dirname(__FILE__) . '/wp-config-ddev.php';
    if (is_readable($ddev_settings) && !defined('DB_USER')) {
      require_once($ddev_settings);
    }
    ````
    
3. **Сохраните** файл.
    

---

## 🚀 Основной блок решения проблем

> Начинайте всегда отсюда.

### 🎯 Этап 1: Коррекция базовых URL и ссылок

> **Когда выполнять:** Всегда. Это решает 90% всех проблем со стилями и ссылками.

1. **Перейдите в папку проекта** в терминале:
    
    codeBash
    
    ```
    cd ~/путь/до/проекта/
    ```
    
2. **Установите правильные URL сайта без слэша в конце.** Замените project.lo на ваш домен.
    
    codeBash
    
    ```
    ddev exec wp option update siteurl 'https://project.lo'
    ddev exec wp option update home 'https://project.lo'
    ```
    
3. **Выполните "глубокий" поиск и замену.** Это обновит все ссылки в контенте и настройках. Замените https://old-project.loc на ваш старый домен и https://project.lo на новый.
    
    codeBash
    
    ```
    ddev exec wp search-replace 'https://old-project.loc' 'https://project.lo' --all-tables
    ```
    
    > [!NOTE] Если search-replace показывает 0 замен, это нормально. Значит, база данных уже чистая. Переходите к следующему шагу.
    
4. **Сбросьте постоянные ссылки.**
    
    - Зайдите в админку (https://project.lo/wp-admin/).
        
    - Перейдите в **Настройки -> Постоянные ссылки**.
        
    - **Ничего не меняя**, нажмите кнопку **Сохранить изменения**.
        
5. **Проверьте результат.** Сделайте жесткую перезагрузку в браузere. Если проблема не решена, переходите к Этапу 2.
    

---

### 🎨 Этап 2: Очистка кэша конструкторов и плагинов

> **Когда выполнять:** Если Этап 1 не помог. Проблема, скорее всего, в сгенерированных CSS/JS файлах.

1. **Зайдите в админку** вашего сайта.
    
2. **Найдите раздел инструментов вашего конструктора страниц** (например, Elementor -> Tools, Divi -> Theme Options, Yellow Pencil -> Settings).
    
3. Найдите и нажмите кнопку **Regenerate CSS & Data**, **Clear Cache** или **Regenerate Files**. Это заставит плагин пересоздать свои файлы стилей.
    
4. **Проверьте другие плагины, которые могут кэшировать:**
    
    - Плагины оптимизации (Lazy Load, Autoptimize).
        
    - Плагины безопасности (All In One WP Security может иметь опции кэширования).
        
    - Если у плагина нет кнопки очистки, попробуйте его **деактивировать и снова активировать**.
        
5. **Проверьте результат.** Сделайте жесткую перезагрузку в браузere. Если проблема не решена, переходите к Этапу 3.
    

---

### 🕵️‍♂️ Этап 3: "Ручной" анализ и ремонт базы данных

> **Когда выполнять:** Если ничего из вышеперечисленного не помогло. Это позволяет найти проблему "глазами".

1. **Откройте phpMyAdmin.** В терминале, в папке проекта, выполните:
    
    codeBash
    
    ```
    ddev phpmyadmin
    ```
    
    (Откроется в браузере, логин и пароль не нужны)
    
2. **Экспортируйте текущую базу данных.**
    
    - В левой колонке выберите базу данных (обычно db).
        
    - Перейдите на вкладку **Export**.
        
    - Метод: **Quick**, Формат: **SQL**.
        
    - Нажмите **Export**. Браузер скачает .sql файл.
        
3. **Проанализируйте файл.**
    
    - Откройте скачанный .sql файл в текстовом редакторе (VS Code, Sublime Text).
        
    - Используйте поиск (Ctrl+F) для поиска любых вхождений старого домена или URL с ошибками (например, с лишним слэшем project.lo/).
        
4. **Если вы нашли и исправили ошибки в файле (или у вас есть "чистый" бэкап):**
    
    - **Удалите старую базу:** В phpMyAdmin, выбрав базу db, перейдите во вкладку **Operations** и нажмите **Drop the database (DROP)**.
        
    - **Импортируйте исправленную базу** через терминал (это надежнее):
        
        codeBash
        
        ```
        # Замените путь на реальный
        ddev import-db --file=~/Загрузки/fixed_db.sql
        ```
        
5. **После импорта ОБЯЗАТЕЛЬНО повторите Этап 1**, чтобы сбросить постоянные ссылки и выполнить search-replace для нового URL.
    

---

### 🔎 Этап 4: Проверка на Mixed Content

> **Когда выполнять:** Если стили "ломаются" и сайт выглядит как "голый" HTML.

1. **Откройте сайт** в браузере.
    
2. Нажмите **F12**, чтобы открыть Инструменты разработчика.
    
3. Перейдите на вкладку **Console (Консоль)**.
    
4. Ищите **красные сообщения об ошибках** со словами Mixed Content. Они покажут, какой именно ресурс (CSS, JS, картинка) пытается загрузиться по http:// вместо https:// (или наоборот).
    
5. Если ошибки найдены, выполните search-replace из Этапа 1, чтобы исправить протоколы во всех ссылках. Например, http://project.lo на https://project.lo.