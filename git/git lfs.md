
# Шпаргалка: Архивирование проекта с большими файлами в Git LFS

Эта инструкция описывает, как переместить большие файлы (например, дампы .sql, архивы .zip), которые **уже были отправлены (push) на GitHub**, под управление Git LFS. Это позволяет сохранить целостность проекта-архива, не раздувая основной репозиторий.

**Сценарий:** Вы отправили проект на GitHub и получили предупреждение о большом файле (50-100 МБ) или ошибку (более 100 МБ).

**Система:** Arch Linux

---

## Шаг 1: Установка и настройка Git LFS

> [!NOTE] Установка  
> Этот шаг выполняется только один раз на вашем компьютере.

1. **Установить пакет git-lfs**  
    Обновляем систему и ставим пакет из официальных репозиториев.
    
    codeBash
    
    ```
    sudo pacman -Syu git-lfs
    ```
    
2. **Активировать Git LFS для вашего пользователя**  
    Эта команда регистрирует LFS в конфигурации вашего Git.
    
    codeBash
    
    ```
    git lfs install
    ```
    

---

## Шаг 2: Миграция проекта в LFS

> [!INFO] Контекст  
> Все следующие команды нужно выполнять, находясь **внутри корневой папки вашего локального проекта** (например, cd ~/projects/work/php/tehnoklinika).

1. **Указать LFS, какие файлы отслеживать**  
    Эта команда определяет, файлы с какими расширениями нужно переместить в LFS. Она создаст или обновит файл .gitattributes в вашем проекте.
    
    codeBash
    
    ```
    # Для SQL-дампов
    git lfs track "*.sql"
    
    # Можно добавить и другие типы файлов, например, архивы
    # git lfs track "*.zip"
    ```
    
2. **Добавить файл конфигурации в индекс**  
    Файл .gitattributes должен быть частью вашего репозитория, чтобы Git всегда знал, как обращаться с большими файлами.
    
    codeBash
    
    ```
    git add .gitattributes
    ```
    
3. **Переписать историю Git для миграции файлов**  
    Это ключевая команда. Она пройдется по всей истории коммитов, найдет указанные файлы и заменит их на легковесные LFS-указатели, переписав коммиты.
    
    codeBash
    
    ```
    git lfs migrate import --include="*.sql"
    ```
    
    > --include указывает, какие файлы мигрировать. Шаблон должен совпадать с тем, что вы указали в git lfs track.
    
4. **Принудительно отправить измененную историю на GitHub**  
    Так как вы изменили прошлые коммиты, ваша локальная история разошлась с историей на сервере. Обычный push будет отклонен. Нужно принудительно заменить историю на сервере вашей новой, исправленной версией.
    
    > [!WARNING] Осторожно с git push --force  
    > Эта команда перезаписывает историю на удаленном сервере. Она **безопасна**, если вы только что создали репозиторий или работаете над ним в одиночку. В командных проектах используйте ее только после согласования со всеми участниками.
    
    codeBash
    
    ```
    git push --force
    ```
    

### Результат

После выполнения этих шагов ваш проект на GitHub будет содержать все файлы, но большие файлы будут помечены как Stored with Git LFS, а предупреждение об их размере исчезнет. Архив проекта сохранен целостно и эффективно.