# VM План для Dell Inspiron 7720: Запуск NixOS + Hyprland

**Теги:** #virtualization #kvm #dell #nixos #hyprland #virtio_3d

> [!DANGER] Важный вердикт по пробросу GPU
> На этом ноутбуке **полноценный проброс видеокарты (GPU Passthrough) невозможен** из-за ограничений Legacy BIOS и аппаратной архитектуры.

---

### Проблема: Почему Hyprland не запускался раньше?

Hyprland — это современный Wayland-композитор, который для своей работы **требует аппаратного 3D-ускорения** (поддержку OpenGL). Стандартная виртуальная машина предоставляет лишь базовую 2D "видеокарту-заглушку" (модель QXL или VGA), которая не умеет в 3D. Hyprland, не найдя нужной поддержки, аварийно завершает работу.

### Решение: Виртуальное 3D-ускорение (VirtIO-GPU)

Мы можем настроить QEMU так, чтобы он "пробрасывал" не саму видеокарту, а только 3D-команды от гостевой системы (NixOS) к хостовой (Arch Linux). Ваша основная видеокарта на хосте будет выполнять рендеринг и отправлять готовую картинку обратно в окно ВМ.

*   **Производительность:** Не такая высокая, как при прямом пробросе, но **этого более чем достаточно, чтобы Hyprland запустился** и работал плавно для настройки конфигов и изучения системы.

---

### Пошаговый план действий

#### Шаг 1: Настройка хоста (Arch Linux)

1.  **Установка KVM/QEMU и утилит:**
    ```bash
    sudo pacman -S qemu-full virt-manager virt-viewer libguestfs
    ```
2.  **Запуск службы `libvirtd`:**
    ```bash
    sudo systemctl enable --now libvirtd.service
    ```
3.  **Добавление пользователя в группу `libvirt`:**
    ```bash
    sudo usermod -aG libvirt $(whoami)
    ```
    > [!NOTE] После этого необходимо **выйти из системы и снова войти**.

#### Шаг 2: Создание и настройка ВМ для NixOS + Hyprland

1.  Запустите `virt-manager`.
2.  Начните создание новой ВМ, указав ISO-образ NixOS.
3.  Выделите 2+ ядра ЦП и 4+ ГБ ОЗУ.
4.  **Очень важно:** на последнем шаге поставьте галочку **"Настроить конфигурацию перед установкой"**.
5.  В открывшемся окне настроек:
    *   Перейдите в раздел **"Видео"**.
    *   Измените **"Модель"** с `QXL` на **`Virtio`**.
    *   Поставьте галочку **"3D-ускорение"** (`Enable 3D acceleration`).
    *   Перейдите в раздел **"Дисплей Spice"**.
    *   В поле **"Listen Type"** выберите **"None"**. Это важно для работы 3D.
6.  Начните установку. После установки NixOS и нужных пакетов (включая Hyprland), он должен успешно запуститься.

#### Шаг 3: ВМ для Windows (Электронная подпись)

*   Создайте еще одну, стандартную ВМ для Windows. **Никаких специальных настроек графики для нее не требуется**.
*   Для работы с USB-токеном используйте меню "Виртуальная машина" -> "Перенаправить USB-устройство" в `virt-manager`.