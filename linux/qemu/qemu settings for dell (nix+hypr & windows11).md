
# KVM: Полное руководство по настройке ВМ на Dell Inspiron 7720

**Теги:** #kvm #virt-manager #nixos #windows11 #dell #шпаргалка #setup

Эта заметка — полное руководство по настройке KVM/QEMU на Arch Linux и созданию виртуальных машин с правильными параметрами для ноутбука Dell Inspiron 7720.

---

### Шаг 1: Подготовка хост-системы (Arch Linux)

Этот раздел описывает все шаги для подготовки Arch Linux к запуску ВМ с 3D-ускорением.

1.  #### Установка всех необходимых пакетов
    Эта команда устанавливает сам QEMU, графический менеджер, пакет для UEFI-прошивок (`edk2-ovmf`) и рендерер для 3D-ускорения (`virglrenderer`).
    ```bash
    sudo pacman -S qemu-full virt-manager virt-viewer dnsmasq edk2-ovmf virglrenderer
    ```

2.  #### Включение OpenGL в конфигурации QEMU
    Это необходимо, чтобы `virt-manager` мог запрашивать 3D-ускорение у системы.
    *   Откройте файл конфигурации: `sudo nano /etc/libvirt/qemu.conf`
    *   Нажмите `Ctrl+W` для поиска, введите `spice_gl` и нажмите Enter.
    *   Найдите строку `#spice_gl = "on"` и **уберите решетку `#`** в начале. Должно получиться так:
        ```ini
        spice_gl = "on"
        ```
    *   Сохраните файл (`Ctrl+X`, `Y`, `Enter`).

3.  #### Запуск и включение службы `libvirtd`
    ```bash
    sudo systemctl enable --now libvirtd.service
    ```
    *После редактирования `qemu.conf` лучше перезапустить службу:*
    ```bash
    sudo systemctl restart libvirtd.service
    ```

4.  #### Добавление пользователя в группу `libvirt`
    ```bash
    sudo usermod -aG libvirt $(whoami)
    ```

5.  #### **ВАЖНО: Перезагрузка системы**
    Чтобы все изменения, права и службы гарантированно заработали, перезагрузите компьютер.

---

### Шаг 2: Точные параметры для создания ВМ

#### Характеристики хоста
*   **Процессор:** Intel Core i7-3610QM (`8 потоков`)
*   **ОЗУ:** 16 ГБ

#### VM 1: NixOS + Hyprland (Оценочная среда)
*   **Процессор (CPUs): `4`**
*   **Память (Memory/RAM): `6144` MiB** (ровно 6 ГБ)
*   **Диск (Storage): `60` GiB**

#### VM 2: Windows 11 (Утилитарная, для ЭП)
*   **Процессор (CPUs): `2`**
*   **Память (Memory/RAM): `4096` MiB** (ровно 4 ГБ)
*   **Диск (Storage): `80` GiB**

---

### Шаг 3: Шпаргалка по настройке графики в `virt-manager`

> [!TIP] Ключевые настройки перед установкой
> В окне настроек ВМ (после галочки "Настроить конфигурацию перед установкой"):
> 1.  **Overview -> Firmware**: Выбрать `UEFI x86_64 ...` **БЕЗ** слова `SECUREBOOT` в названии.
> 2.  **Video -> Model**: Установить `Virtio` и поставить галочку **`3D acceleration`**.
> 3.  **Display Spice -> Listen type**: Установить `None`.