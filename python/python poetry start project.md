
# Справочник: Настройка Python-проекта (asdf + Poetry + VSCode + Zsh)


Этот справочник описывает профессиональный и воспроизводимый рабочий процесс для Python-проектов.

## 1. Философия и Инструменты

- **zsh**: Наша командная оболочка, где мы работаем.
    
- **asdf-vm**: Управляет версиями самого **языка** (Python). Гарантирует, что мы используем нужную версию Python для проекта. Аналог nvm в JS.
    
- **Poetry**: Управляет **проектом**. Отвечает за зависимости, виртуальное окружение и сборку пакета. Аналог npm или yarn.
    
- **VSCode**: Наша среда разработки. Мы настраиваем ее так, чтобы она "понимала" окружение, созданное Poetry.
    

---

## 2. Пошаговая настройка нового проекта

### Шаг 1: Подготовка и выбор Python (asdf)

1. **Создать папку проекта:**
    
    Generated bash
    
    ```
    mkdir мой-проект && cd мой-проект
    ```
    
    
2. **Установить нужную версию Python:** Важно: всегда используем последнюю **стабильную** версию, а не альфа/бета.
    
    Generated bash
    
    ```
    # (Если нужно) Установить системные зависимости для сборки Python на Arch
    # sudo pacman -S base-devel openssl zlib xz tk
    
    # Установить сам Python через asdf
    asdf install python 3.13.5
    ```
    
    
3. **"Привязать" версию к проекту:** Это **ключевой шаг**. Он создает в папке файл .tool-versions, который является инструкцией для asdf.
    
    Generated bash
    
    ```
    asdf local python 3.13.5
    ```
    
    

### Шаг 2: Инициализация проекта (Poetry)

1. **Запустить poetry init:** Находясь в папке, запускаем интерактивный мастер настройки.
    
    Generated bash
    
    ```
    poetry init
    ```
    
    
2. **Заполнить "паспорт" проекта (pyproject.toml):**
    
    - Compatible Python version: Указать ту же версию, что и в asdf (например, ^3.13).
        
    - Добавить основные зависимости (например, pysrt).
        
3. **Создать README:** Poetry требует этот файл по умолчанию.
    
    Generated bash
    
    ```
    touch README.md
    ```
    
    
4. **Определить тип проекта:**
    
    - **Сценарий А (по умолчанию):** Вы создаете библиотеку/пакет для публикации. Ваш код должен лежать в подпапке мой_проект/.
        
    - **Сценарий Б (наш случай):** Вы создаете простой скрипт или приложение, не предназначенное для упаковки. Чтобы избежать ошибки No file/folder found..., нужно явно отключить "режим пакета".
        
        - Откройте pyproject.toml.
            
        - Добавьте в конец файла:
            
            Generated toml
            
            ```
            [tool.poetry]
            package-mode = false
            ```
            
            

### Шаг 3: Установка и запуск

1. **Установить зависимости:** Эта команда — сердце Poetry. Она:
    
    - Создает виртуальное окружение (если его нет).
        
    - Читает pyproject.toml.
        
    - Устанавливает все зависимости.
        
    - Создает/обновляет файл poetry.lock.
        
    
    Generated bash
    
    ```
    poetry install
    ```
    
    
2. **Запускать скрипты через poetry run:** Это префикс, который гарантирует, что команда выполняется внутри правильного виртуального окружения со всеми библиотеками.
    
    Generated bash
    
    ```
    poetry run python мой_скрипт.py
    ```
    
    

### Шаг 4: Интеграция с VSCode

1. **Открыть проект:** code .
    
2. **Выбрать правильный интерпретатор:**
    
    - Нажмите Ctrl+Shift+P, введите Python: Select Interpreter.
        
    - В списке выберите тот, в пути которого есть .../.cache/pypoetry/virtualenvs/....
        
    - Теперь VSCode будет использовать то же окружение, что и Poetry, и перестанет подчеркивать существующие импорты.
        

---

## 3. Траблшутинг: Решение проблем, с которыми мы столкнулись

#### Проблема: В терминале активен "чужой" (.venv)

- **Симптом:** Перед командной строкой есть префикс (.venv). Команды poetry run работают неправильно.
    
- **Диагноз:** Активно старое виртуальное окружение, которое конфликтует с Poetry.
    
- **Решение:** Выполнить команду deactivate для очистки сессии терминала. Префикс должен исчезнуть.
    

#### Проблема: ModuleNotFoundError после poetry install

- **Симптом:** poetry run python ... не видит модуль, который должен быть установлен.
    
- **Диагноз:** Окружение Poetry по какой-то причине пустое или повреждено.
    
    1. Проверяем: poetry run pip list показывает только pip.
        
- **Решение (Полная перезагрузка):**
    
    1. poetry env list — посмотреть имя окружения.
        
    2. poetry env remove <имя_окружения> — полностью удалить сбойное окружение.
        
    3. poetry install — создать все заново и установить зависимости.
        

#### Проблема: VSCode подчеркивает импорты (Cannot resolve import...)

- **Симптом:** import pysrt подчеркнут волнистой линией, хотя в терминале все работает.
    
- **Диагноз:** VSCode смотрит не на то виртуальное окружение.
    
- **Решение:** Ctrl+Shift+P -> Python: Select Interpreter и выбрать интерпретатор из кеша Poetry.
    

---

Отлично, заметка обновлена и содержит весь наш ценный опыт.

Теперь, когда вся настройка позади и работает как часы, мы наконец можем заняться самим скриптом.

**Продолжаем!** Перенесем логику из исходного текста в наш новый, чистый проект.
