# Миграция с ASDF на Mise на Arch Linux

## Почему переходим?

mise (ранее rtx) — это современная, быстрая и удобная замена для asdf.

- **Скорость:** Ядро на Go/Rust значительно быстрее, чем asdf на Bash. Отклик терминала становится мгновенным.
    
- **Удобство:** mise автоматически устанавливает недостающие инструменты при заходе в директорию.
    
- **Надежность на Arch:** mise находится в официальных репозиториях (extra).
    
- **Совместимость:** mise на 100% совместим с файлами .tool-versions и плагинами asdf.
    

---

## Пошаговый план миграции

### 1. Полная очистка от asdf

> **Цель:** Убрать старый менеджер и его конфигурацию, чтобы избежать конфликтов.

1. **Удалить системный пакет asdf:** yay -Rns asdf-vm
    
2. **Очистить .zshrc:** Открыть ~/.zshrc и полностью удалить строки, связанные с asdf.
    
3. **Сделать бекап (опционально):** mv ~/.asdf ~/.asdf_backup
    

### 2. Установка и настройка mise

> **Цель:** Установить mise и интегрировать его в рабочую оболочку.

1. **Установить mise:** yay -S mise
    
2. **Активировать mise в .zshrc:** Убедиться, что следующая строка находится **в самом конце** файла ~/.zshrc:
    
    codeBash
    
    ```
    # mise - modern, fast tool version manager
    eval "$(mise activate zsh)"
    ```
    
3. **Применить изменения:** **Полностью перезапустить все окна терминала** или выполнить source ~/.zshrc.
    

### 3. Восстановление инструментов

> **Цель:** Переустановить все необходимые версии ПО.

1. Зайдите в директорию проекта с файлом .tool-versions.
    
2. Запустите установку: mise install
    

> ⚠️ **Внимание!** Если mise install завершается с ошибкой (например, для **pnpm**), это значит, что плагин устарел. **Переходите к следующему разделу.**

---

## Решение проблем: Устаревшие плагины (pnpm) и "Осознанный Подход"

> **Проблема:** Старые плагины asdf для некоторых инструментов больше не работают.

**Решение:** Принять осознанный подход, где мы управляем Node.js через mise, а способ запуска pnpm зависит от "возраста" проекта.

#### Шаг 1: Исправить .tool-versions в старом проекте

1. Откройте .tool-versions в проблемном проекте.
    
2. **Отредактируйте файл:**
    
    - **Удалите** строку с pnpm.
        
    - **Исправьте** nodejs на node.
        
    
    **Пример:**
    
    codeDiff
    
    ```
    - nodejs 10.24.1
    - pnpm 5.18.10
    + node 10.24.1
    ```
    
3. Запустите mise install, чтобы установить только node.
    

#### Шаг 2: Принять два правила для запуска pnpm

Мы не будем создавать глобальных "костылей" (алиасов или функций). Вместо этого мы будем использовать разные команды для разных типов проектов.

**Правило 1: Для старых проектов (где плагин pnpm сломан)**

- **Всегда используйте npx для вызова pnpm**.
    
- Это гарантирует, что будет запущена именно та версия pnpm, что указана в package.json проекта.
    
- **Пример полного цикла работы:**
    
    codeBash
    

> **Это безопасно!** Если вы случайно введете pnpm start без npx, вы либо получите ошибку command not found, либо запустится другая версия pnpm, но она не повредит ваши файлы. Худшее, что придется сделать — удалить node_modules и запустить правильную команду.

**Правило 2: Для новых и будущих проектов**

- В .tool-versions вы можете смело указывать и node, и pnpm:
    
    codeCode
    
    ```
    node 20.9.0
    pnpm 8.6.0
    ```
    
- mise install установит оба инструмента.
    
- mise автоматически сделает команду pnpm доступной.
    
- **Используйте pnpm напрямую, без npx:**
    
    codeBash
    
    ```
    pnpm install
    pnpm dev
    ```
    

---

### 4. Финальная очистка

- После того как вы убедились, что mise работает и все проекты запускаются, можно безопасно удалить бекап: rm -rf ~/.asdf_backup