# Миграция с ASDF на Mise на Arch Linux

## Почему переходим?

mise (ранее rtx) — это современная, быстрая и удобная замена для asdf.

- **Скорость:** Ядро на Go/Rust значительно быстрее, чем asdf на Bash. Отклик терминала становится мгновенным.
    
- **Удобство:** mise автоматически устанавливает недостающие инструменты при заходе в директорию.
    
- **Надежность на Arch:** mise находится в официальных репозиториях (extra).
    
- **Совместимость:** mise на 100% совместим с файлами .tool-versions и плагинами asdf.
    

---

## Пошаговый план миграции

### 1. Полная очистка от asdf

> **Цель:** Убрать старый менеджер и его конфигурацию, чтобы избежать конфликтов.

1. **Удалить системный пакет asdf:** yay -Rns asdf-vm
    
2. **Очистить .zshrc:** Открыть ~/.zshrc и полностью удалить строки, связанные с asdf.
    
3. **Очистить глобальный конфиг (важно!):** Удалить файл ~/.tool-versions, если он существует. rm ~/.tool-versions
    
4. **Сделать бекап (опционально):** mv ~/.asdf ~/.asdf_backup
    

### 2. Установка и настройка mise

> **Цель:** Установить mise и интегрировать его в рабочую оболочку.

1. **Установить mise:** yay -S mise
    
2. **Активировать mise в .zshrc:** Убедиться, что следующая строка находится **в самом конце** файла ~/.zshrc:
    
    codeBash
    
    ```
    # mise - modern, fast tool version manager
    eval "$(mise activate zsh)"
    ```
    
3. **Применить изменения:** **Полностью перезапустить все окна терминала**.
    

---

## Решение проблем: Устаревшие плагины (pnpm) и "Элегантное Обновление"

> **Проблема:** В старых проектах (gnb-prokol, zentavrstroy) используется pnpm@5, плагин для которого больше не работает, что приводит к ошибке mise install.

**Решение:** Не использовать "костыль" с npx. Вместо этого мы немного обновим pnpm до версии v6, плагин для которой все еще работает, и которая совместима со старым Node.js v10.

#### Шаг 1: Исправить .tool-versions в старом проекте

1. Откройте .tool-versions в проблемном проекте.
    
2. **Отредактируйте файл:**
    
    - Замените pnpm 5.x.x на pnpm 6.35.1.
        
    - Исправьте nodejs на современный стандарт node.
        
    
    **Пример правки:**
    
    codeDiff
    
    ```
    - nodejs 10.24.1
    - pnpm 5.18.10
    + node 10.24.1
    + pnpm 6.35.1
    ```
    

#### Шаг 2: Чистая установка

1. **Очистите проект** от старых артефактов, включая старый лок-файл:
    
    codeBash
    
    ```
    rm -rf node_modules package-lock.json pnpm-lock.yaml
    ```
    
2. **Попросите mise установить** обновленные инструменты:
    
    codeBash
    
    ```
    mise install
    ```
    
3. **Запустите установку зависимостей** уже напрямую через pnpm:
    
    codeBash
    
    ```
    pnpm install
    ```
    
    Будет сгенерирован новый pnpm-lock.yaml, совместимый с pnpm v6.
    

#### Шаг 3: Работа с проектом

Теперь вы можете работать с проектом **напрямую, без npx**, как и со всеми новыми проектами:

codeBash

```
pnpm start
pnpm build
```

---

### 4. Финальная очистка

- После того как вы убедились, что mise работает и все проекты запускаются, можно безопасно удалить бекап: rm -rf ~/.asdf_backup
    

