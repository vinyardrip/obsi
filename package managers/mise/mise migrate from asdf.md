# Миграция с ASDF на Mise на Arch Linux

## Почему переходим?

mise (ранее rtx) — это современная, быстрая и удобная замена для asdf.

- **Скорость:** Ядро на Go/Rust значительно быстрее, чем asdf на Bash. Отклик терминала становится мгновенным.
    
- **Удобство:** mise автоматически устанавливает недостающие инструменты при заходе в директорию (не нужно вручную запускать install).
    
- **Надежность на Arch:** mise находится в официальных репозиториях (extra), в то время как asdf из AUR (asdf-vm) может быть нестабилен.
    
- **Совместимость:** mise на 100% совместим с файлами .tool-versions и плагинами asdf.
    

---

## Пошаговый план миграции

### 1. Полная очистка от asdf

> **Цель:** Убрать старый менеджер и его конфигурацию, чтобы избежать конфликтов.

1. **Удалить системный пакет asdf:**
    
    codeBash
    
    ```
    yay -Rns asdf-vm
    ```
    
2. **Очистить .zshrc:**
    
    - Открыть ~/.zshrc в редакторе.
        
    - Найти и полностью удалить строки, связанные с asdf.
        
3. **Сделать бекап установленных версий (опционально, но рекомендуется):**
    
    - Если директория ~/.asdf существует (от ручной установки), переименовать её:
        
        codeBash
        
        ```
        mv ~/.asdf ~/.asdf_backup
        ```
        

### 2. Установка и настройка mise

> **Цель:** Установить mise и интегрировать его в рабочую оболочку.

1. **Установить mise из официальных репозиториев:**
    
    codeBash
    
    ```
    yay -S mise
    ```
    
2. **Активировать mise в .zshrc:**
    
    - Убедиться, что следующая строка находится **в самом конце** файла ~/.zshrc для гарантии приоритета над другими инструментами:
        
        codeBash
        
        ```
        # mise - modern, fast tool version manager
        eval "$(mise activate zsh)"
        ```
        
    - Можно добавить её командой:
        
        codeBash
        
        ```
        echo -e '\n# mise - modern, fast tool version manager\neval "$(mise activate zsh)"' >> ~/.zshrc
        ```
        
3. **Применить изменения:**
    
    - **Полностью перезапустить все окна терминала** или выполнить в каждом:
        
        codeBash
        
        ```
        source ~/.zshrc
        ```
        

### 3. Восстановление инструментов

> **Цель:** Переустановить все необходимые версии ПО с помощью нового менеджера.

1. Зайдите в директорию проекта с файлом .tool-versions.
    
2. Запустите установку:
    
    codeBash
    
    ```
    mise install
    ```
    

> ⚠️ **Внимание!** Если mise install завершается с ошибкой, жалуясь на невозможность скачать плагин (например, для **pnpm**), это значит, что плагин устарел и больше не существует. **Немедленно переходите к следующему разделу.**

---

## Решение проблем: Устаревшие плагины (pnpm)

> **Проблема:** Некоторые старые плагины asdf (особенно для pnpm) были удалены с GitHub. mise не может их скачать, и установка прерывается.

**Решение:** Не управлять таким инструментом через mise напрямую. Вместо этого управлять **только** версией Node.js через mise, а сам инструмент (pnpm) устанавливать как локальную зависимость проекта и использовать удобный алиас.

#### Шаг 1: Исправить .tool-versions

Это **ключевой шаг**. Нужно убрать из файла инструкцию по установке проблемного инструмента и исправить устаревшие названия.

1. Откройте файл .tool-versions в проблемном проекте.
    
2. **Отредактируйте файл:**
    
    - **Удалите** строку с pnpm.
        
    - **Исправьте** nodejs на современный стандарт node.
        
    
    **Пример правки:**
    
    codeDiff
    
    ````
    - nodejs 10.24.1
    - pnpm 5.18.10
    + node 10.24.1
    ```3.  Теперь снова запустите установку. `mise` установит **только** `node` и не будет спотыкаться на `pnpm`.
    ```bash
    mise install
    ````
    

#### Шаг 2: Установить pnpm локально

1. **Удалите старые артефакты**, если они остались от неудачных попыток (package-lock.json создается npm и не нужен в pnpm-проектах):
    
    codeBash
    
    ```
    rm -rf node_modules package-lock.json
    ```
    
2. Запустите установку зависимостей, **явно указав версию pnpm для npx**. Это нужно сделать только один раз для "загрузки" node_modules с правильной версией pnpm.
    
    codeBash
    
    ```
    # Замените 5.18.10 на нужную вам версию из package.json
    npx pnpm@5.18.10 install
    ```
    

#### Шаг 3: Настроить удобный алиас (раз и навсегда)

Старые версии pnpm (< 6.x) не имеют команды setup. Поэтому мы создадим универсальный алиас, который будет работать для любых версий.

1. Откройте ~/.zshrc.
    
2. В секцию, где хранятся ваши алиасы, добавьте:
    
    codeBash
    
    ```
    # Универсальный вызов pnpm через npx, работает для любой версии в любом проекте
    alias pnpm='npx pnpm'
    ```
    
3. **Перезапустите терминал** или выполните source ~/.zshrc.
    

Теперь вы можете просто и привычно использовать pnpm install, pnpm start и т.д. во всех проектах, как и раньше.

---

### 4. Финальная очистка

> **Цель:** Удалить старые, больше не нужные файлы.

- После того как вы убедились, что mise работает и все проекты запускаются, можно безопасно удалить бекап:
    
    codeBash
    
    ```
    rm -rf ~/.asdf_backup
    ```